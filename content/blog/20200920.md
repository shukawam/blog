+++
title = "【Dev Challenges】Authentication App"
description = ""
author = "Shuhei, Kawamura"
date = "2020-09-19"
tags = ["Angular", "Bootstrap"]
categories = ["tech", "Dev Challenges"]
draft = "true"
[[images]]
  src = "img/2020/0920/devchallenges.jpg"
  alt = "DevChallenges"
  stretch = "stretchH"
+++

# 始めに

[フルスタックエンジニアになるためのモダンな 8 つのプロジェクト](https://qiita.com/kanye__east/items/77a9746e9b98abbb97e6)に影響を受けたので、[Dev Challenges](https://devchallenges.io/challenges)のプロジェクトをやってみようと思います。今回は、[4. Authentication App](https://devchallenges.io/challenges/N1fvBjQfhlkctmwj1tnw)に取り組みます。解法というよりは自分の作業メモのような立ち位置で残したいと思います。

# 環境

- フロントエンド
  - Node.js v12.18.4
    - Angular v10.1.2
- サーバサイド
  - Java 11
    - Spring Boot 2.3.4
- データベース
  - Oracle ATP(Autonomous Transaction Processing)

# 画面モックを作成する

個人的に API を作ってから画面を作ることの方が多いのですが、なんとなく画面から実装します。（API だけ作って飽きてしまうことが多い）

## 作業メモ

全て記載していると日が暮れそうなのでポイントだけかいつまんで記載します。

### Angular CLI を使用して、ひな型を作成する。

```
$ ng new authentication-app-front --routing --style css
```

[https://www.figma.com/file/ZM0DPZbzK39o3rqwiaOPTD/Authentication-App?node-id=0%3A1](https://www.figma.com/file/ZM0DPZbzK39o3rqwiaOPTD/Authentication-App?node-id=0%3A1)によるとどうやら実装する必要のある画面は 3 画面あるようで、便宜上以下のような名前にしておきます。

- ログイン画面
- ユーザ情報参照画面
- ユーザ情報編集画面

これに合わせて、`module`, `component`を作成する。

```
$ ng generate module auth
$ ng generate module users
$ ng geenrate component auth/login
$ ng generate component users/user-detail
$ ng generate component users/user-edit
```

一通り、作成が完了すると`src/app`配下は以下のようなディレクトリ構造になっているはずです。この辺りの全体構造は、[Angular が提唱しているコーディングスタイルガイド](https://angular.jp/guide/styleguide#%E5%85%A8%E4%BD%93%E6%A7%8B%E9%80%A0%E3%81%AE%E3%82%AC%E3%82%A4%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3)が参考になります。

```
C:.
│  app-routing.module.ts
│  app.component.css
│  app.component.html
│  app.component.spec.ts
│  app.component.ts
│  app.module.ts
│
├─auth
│  │  auth.module.ts
│  │
│  └─login
│          login.component.css
│          login.component.html
│          login.component.spec.ts
│          login.component.ts
│
└─users
    │  users.module.ts
    │
    ├─user-detail
    │      user-detail.component.css
    │      user-detail.component.html
    │      user-detail.component.spec.ts
    │      user-detail.component.ts
    │
    └─user-edit
            user-edit.component.css
            user-edit.component.html
            user-edit.component.spec.ts
            user-edit.component.ts
```

### Bootstrap を使用する

Angular 9.0.0 以上かつ ng-bootstrap 6.0.0 以上の場合は`@angular/localize` を polyfills に追加する必要があります。

```
$ ng add @angular/localize
```

`ng-bootstrap`をインストールする。（Bootstrap に依存しているため、一緒にインストールします）

```
$ npm install @ng-bootstrap/ng-bootstrap bootstrap
```

ルートモジュールにインポートします。

**app.module.ts**

```ts
import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';

import { AppRoutingModule } from './app-routing.module';
import { AppComponent } from './app.component';
import { NgbModule } from '@ng-bootstrap/ng-bootstrap';

@NgModule({
  declarations: [AppComponent],
  imports: [
    BrowserModule,
    AppRoutingModule,
    NgbModule, // <- 追加
  ],
  providers: [],
  bootstrap: [AppComponent],
})
export class AppModule {}
```

Bootstrap をグローバルスタイルとして使用するための設定を`angular.json`に追加します。

```
"styles": [
  "src/styles.css",
  "./node_modules/bootstrap/dist/css/bootstrap.min.css" // <- 追加
],
```

### Font Awesome を使用する

[Dev Challenges](https://devchallenges.io/challenges/N1fvBjQfhlkctmwj1tnw)では、Material Icons が使用されているみたいですが、読む前に Font Awesome を使用してしまいました。事前に課題を読める人はちゃんと Material Icons 使ってください。

```
$ npm install @fortawesome/fontawesome-free
```

グローバルスタイルとして使用するための設定を`angular.json`に追加する。

```
"styles": [
  "src/styles.css",
  "./node_modules/bootstrap/dist/css/bootstrap.min.css",
  "./node_modules/@fortawesome/fontawesome-free/css/all.min.css" // <- 追加
],
"scripts": [
  "./node_modules/@fortawesome/fontawesome-free/js/all.min.js" // <- 追加
]
```

### 画面のモックを作成する

ここではサーバサイドと通信しない、いわゆる画面モックを作成しますが、内容は割愛するのでリポジトリを参照してください。作った画面だけ晒しておきます。

#### ログイン画面

![img01](http://localhost:1313/blog/img/2020/0920/img01.png)

ソースコードは[こちら](https://github.com/shukawam/authentication-app-front/tree/master/src/app/auth/login)からどうぞ。

#### ユーザ情報参照画面

![img02](http://localhost:1313/blog/img/2020/0920/img02.png)

ソースコードは[こちら](https://github.com/shukawam/authentication-app-front/tree/master/src/app/users/user-detail)からどうぞ。

#### ユーザ情報編集画面

![img03](http://localhost:1313/blog/img/2020/0920/img03.png)

ソースコードは[こちら](https://github.com/shukawam/authentication-app-front/tree/master/src/app/users/user-edit)からどうぞ。

# テーブルの設計をする

画面モックを一旦作りきったところで次はテーブルの設計をします。今回は以下のようなテーブルを作成しようと思います。シンプルなアプリケーションなだけあってテーブルは一つで事足りそうです。

**users**

| カラム名   | カラム名（日本語） | 型            | 制約        | 説明                                                             |
| ---------- | ------------------ | ------------- | ----------- | ---------------------------------------------------------------- |
| USER_ID    | ユーザ ID          | INTEGER       | PRIMARY_KEY | DB のシーケンスを利用して自動採番する                            |
| USER_NAME  | ユーザ名           | VARCHAR2(50)  | NOT NULL    |                                                                  |
| EMAIL      | メールアドレス     | VARCHAR2(100) | NOT NULL    |                                                                  |
| PASSWORD   | パスワード         | VARCHAR2(50)  | NOT NULL    |                                                                  |
| IMAGE_PATH | 画像パス           | VARCHAR2(200) |             | 実データは DB で保持せずにストレージ（今回はローカル）に保存する |

# API を作成する

画面モックの作成とテーブルの設計が終了したので、API を作成します。画面ベースでざっと以下の API が必要でしょうか。

**ログイン画面**

| エンドポイント                                      | HTTP Methpd | 説明                                  |
| --------------------------------------------------- | ----------- | ------------------------------------- |
| `/api/v1/auth/login`                                | POST        | Spring Security の認証用の API        |
| `/api/v1/auth/social-login?service={socialService}` | POST        | Spring Security の OAuth 認証用の API |

**ユーザ情報参照画面**

| エンドポイント          | HTTP Methpd | 説明                                           |
| ----------------------- | ----------- | ---------------------------------------------- |
| `/api/v1/user/{userId}` | GET         | 画面初期表示時にユーザ情報を取得するための API |

**ユーザ情報編集画面**

| エンドポイント          | HTTP Methpd | 説明                           |
| ----------------------- | ----------- | ------------------------------ |
| `/api/v1/user/{userId}` | PUT         | ユーザ情報を更新するための API |

## ひな型を作成する
冒頭にもありましたが、今回はSpring Bootで作成します。

# 終わりに

# 参考

- [https://github.com/FortAwesome/angular-fontawesome](https://github.com/FortAwesome/angular-fontawesome)
- [https://qiita.com/tomy0610/items/da6871e19d9372d56e2e](https://qiita.com/tomy0610/items/da6871e19d9372d56e2e)
